(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(e,r,t){e.exports=t(19)},17:function(e,r,t){},18:function(e,r,t){},19:function(e,r,t){"use strict";t.r(r);var a=t(0),n=t.n(a),s=t(4),o=t.n(s),c=(t(17),t(2)),i=t(5),l=t(6),u=t(7),d=t(9),m=t(8),h=t(10),f=t(1),v=(t(18),function(e){var r=e.updateSender,t=e.value,a=e.disabled,s=e.handleSubmit;return n.a.createElement("div",{className:"login"},n.a.createElement("form",null,n.a.createElement("input",{name:"username",placeholder:"Enter Username",value:t,onChange:function(e){return r(e.target.value)}}),n.a.createElement("button",{onClick:function(e){return s(e)},disabled:a},"Login")))}),p=function(e){var r=e.users;if(!r)return"";var t=0,a=Object.values(r).map(function(e){return n.a.createElement("li",{key:t++},n.a.createElement("div",{className:"user"},n.a.createElement("span",{className:"username"},e)))});return n.a.createElement("ul",{className:"users"},a)},g=function(e){var r=e.messages;if(!r)return"";var t=0,a=r.map(function(e){return n.a.createElement("li",{key:t++},n.a.createElement("div",{className:"message"},n.a.createElement("div",{className:"meta-info"},n.a.createElement("div",{className:"sender-info"},n.a.createElement("span",{className:"username"},e.sender)),n.a.createElement("div",{className:"message-info"},n.a.createElement("span",{className:"timestamp"},new Date(e.timestamp).toString()))),n.a.createElement("p",{className:"message-text"},e.text)))});return n.a.createElement("ul",{className:"users"},a)},E=function(e){var r=e.value,t=e.handleSubmit,a=e.handleChange,s=(e.keyPress,e.disabled);return n.a.createElement("div",{className:"outgoing"},n.a.createElement("form",null,n.a.createElement("input",{className:"to-send",value:r,placeholder:"Enter message to send",onChange:function(e){return a(e)}}),n.a.createElement("button",{disabled:s,onClick:t},"Send")))},b=function(e){var r=e.logout;return n.a.createElement("div",{className:"logout"},n.a.createElement("button",{onClick:r},"Logout"))},y=function(e){var r=e.allUsers,t=e.allMessages,a=e.value,s=e.handleSubmit,o=e.handleChange,c=e.keyPress,i=e.logout,l=e.disabled;return n.a.createElement("div",{className:"chat-app"},n.a.createElement("div",{className:"display-panel"},n.a.createElement(p,{users:r}),n.a.createElement(g,{messages:t})),n.a.createElement("div",{className:"send-panel"},n.a.createElement(E,{value:a,handleSubmit:s,handleChange:o,keyPress:c,disabled:l})),n.a.createElement(b,{logout:i}))},S=function(e){var r=e.errorMessage;if(!r)return n.a.createElement("div",{className:"show-errors"});var t=0,a=Object.values(r).map(function(e){return n.a.createElement("li",{key:t++},n.a.createElement("div",{className:"error-message"},n.a.createElement("span",{className:"error"},e.toString())))});return n.a.createElement("div",{className:"show-errors"},n.a.createElement("ul",{className:"show-errors-list"},a))},k=function(e){function r(){var e;return Object(l.a)(this,r),(e=Object(d.a)(this,Object(m.a)(r).call(this))).state={value:"",tempsender:""},e.handleChange=e.handleChange.bind(Object(f.a)(Object(f.a)(e))),e.handleSubmit=e.handleSubmit.bind(Object(f.a)(Object(f.a)(e))),e.handleLoginSubmit=e.handleLoginSubmit.bind(Object(f.a)(Object(f.a)(e))),e.updateSender=e.updateSender.bind(Object(f.a)(Object(f.a)(e))),e.logout=e.logout.bind(Object(f.a)(Object(f.a)(e))),e}return Object(h.a)(r,e),Object(u.a)(r,[{key:"updateSender",value:function(e){e&&this.setState({tempsender:e})}},{key:"getStateError",value:function(){return this.state.error}},{key:"setStateError",value:function(e){var r=e.err,t=e.errorType;t&&this.setState(function(e){return{error:Object(i.a)({},e.error,Object(c.a)({},t,r))}})}},{key:"handleLoginSubmit",value:function(e){var r=this;e.preventDefault();var t=this.state.tempsender;!function(e){var r=e.username,t=e.callback;fetch("/login/",{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify({username:r})}).catch(function(e){return Promise.reject({err:e,errorType:"service-error"})}).then(function(e){if(!e.ok)return e.json();t({err:"",errorType:"LoginError"})}).then(function(e){if(e)throw new Error(e.error)}).catch(function(e){return t({err:e,errorType:"LoginError"})})}({username:t,callback:function(e){var t=e.err,a=e.errorType;r.setStateError({err:t,errorType:a})}}),this.setState({sender:t,tempsender:""})}},{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"handleSubmit",value:function(e){var r=this;if(e.preventDefault(),this.state.value){!function(e){var r=e.username,t=e.text,a=e.callback;fetch("/messages/",{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify({username:r,text:t})}).catch(function(e){return Promise.reject({err:e,errorType:"service-error"})}).then(function(e){if(!e.ok)return e.json();a({err:"",errorType:"sendMessageError"})}).then(function(e){if(e)throw new Error(e.error)}).catch(function(e){return a({err:e,errorType:"sendMessageError"})})}({username:this.state.sender,text:this.state.value,callback:function(e){var t=e.err,a=e.errorType;r.setStateError({err:t,errorType:a})}}),this.getAllUsersAndMessages(),this.setState({value:""})}}},{key:"updateUsersState",value:function(){var e=this;(function(e){var r=e.callback;return fetch("/users/").catch(function(e){return Promise.reject({err:e,errorType:"service-error"})}).then(function(e){if(e.ok)return r({err:"",errorType:"updateUserError"}),e.json();throw new Error("Couldn't get User data!")}).catch(function(e){return r({err:e,errorType:"updateUserError"})})})({callback:function(r){var t=r.err,a=r.errorType;e.setStateError({err:t,errorType:a})}}).then(function(r){e.setState({allUsers:r})})}},{key:"updateMessagesState",value:function(){var e=this;(function(e){var r=e.callback;return fetch("/messages/").catch(function(e){return Promise.reject({err:e,errorType:"service-error"})}).then(function(e){if(e.ok)return r({err:"",errorType:"UpdateMessageError"}),e.json();throw new Error("Couldn't get Message data!")}).catch(function(e){return r({err:e,errorType:"UpdateMessageError"})})})({callback:function(r){var t=r.err,a=r.errorType;e.setStateError({err:t,errorType:a})}}).then(function(r){e.setState({allMessages:r})})}},{key:"getAllUsersAndMessages",value:function(){this.updateUsersState(),this.updateMessagesState()}},{key:"logout",value:function(){var e=this;!function(e){var r=e.username,t=e.callback;fetch("/logout/",{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify({username:r})}).catch(function(e){return Promise.reject({err:e,errorType:"service-error"})}).then(function(e){if(!e.ok)return e.json();t({err:"",errorType:"LogoutError"})}).then(function(e){if(e)throw new Error(e.error)}).catch(function(e){return t({err:e,errorType:"LogoutError"})})}({username:this.state.sender,callback:function(r){var t=r.err,a=r.errorType;e.setStateError({err:t,errorType:a})}}),delete this.state.sender,this.setState(this.state)}},{key:"componentDidMount",value:function(){var e=this;this.getAllUsersAndMessages(),setInterval(function(){e.getAllUsersAndMessages()},5e3)}},{key:"checkDisabled",value:function(){return!this.state.value}},{key:"checkLoginStatus",value:function(){return this.state.sender?n.a.createElement(y,{allUsers:this.state.allUsers,allMessages:this.state.allMessages,value:this.state.value,handleSubmit:this.handleSubmit,handleChange:this.handleChange,logout:this.logout,disabled:!this.state.value}):n.a.createElement(v,{updateSender:this.updateSender,value:this.state.sender,handleSubmit:this.handleLoginSubmit,disabled:!this.state.tempsender})}},{key:"render",value:function(){return n.a.createElement("div",{id:"chat-app"},this.checkLoginStatus(),n.a.createElement("div",{className:"error-report"},n.a.createElement(S,{errorMessage:this.state.error})))}}]),r}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(k,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[11,1,2]]]);
//# sourceMappingURL=main.5d186db8.chunk.js.map